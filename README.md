# Marketplace API

RESTful сервис, имитирующий торговую площадку.

## Реализованный функционал

- **Авторизация:**
  - Регистрация (`/auth/register`) и авторизация (`/auth/login`) по логину и паролю.
  - Токен проверяется для защищенных эндпоинтов.
- **Размещение Объявлений:**
  - Авторизованные пользователи создают объявления (заголовок, текст, URL изображения, цена). Все поля валидируются.
- **Лента Объявлений:**
  - Отображает список объявлений с пагинацией, сортировкой (по дате/цене) и фильтрацией по цене. Для авторизованных пользователей показывает признак isOwner.
- **Метрики:**
  - Сбор технических и бизнес-метрик с помощью Prometheus (порт 9000, `/metrics`).
- **Логирование:**
  - Настроено логирование событий сервиса.
- **Тестирование:**
  - Реализованы интеграционные тесты.

## Стек технологий

- Go, Chi, PostgreSQL, Docker, Prometheus, Swagger

## Запуск проекта

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/ocenb/pvz.git
    cd pvz
    ```
2.  **Настройте окружение:**
    Скопируйте файл с примером переменных окружения и отредактируйте, если нужно:
    ```bash
    cp .env.example .env
    ```
3.  **Сборка и запуск:**
    Используйте Makefile:

    ```bash
    make up-build
    ```

    Или напрямую Docker Compose:

    ```bash
    docker compose up -d --build
    ```

    - HTTP API `http://localhost:8080`.
    - Документация `http://localhost:8080/swagger/index.html`.

4.  **Остановка:**
    ```bash
    make down
    ```
    или
    ```bash
    docker compose down
    ```

## Интеграционные тесты

```bash
make test
```

Используется `docker-compose.test.yaml` для тестового окружения.

## Структура кода

```
├── cmd/
│   └── marketplace/ # Основное приложение
├── deployments/     # Файлы для деплоя
├── docks/           # Swagger документация
├── internal/
│   ├── config/      # Конфигурация приложения
│   ├── handlers/    # Обработчики HTTP запросов
│   ├── http/        # HTTP сервер
│   ├── logger/      # Настройка логирования
│   ├── metrics/     # Сбор и предоставление метрик
│   ├── middlewares/ # HTTP middlewares
│   ├── models/      # Модели данных
│   ├── repos/       # Репозитории для работы с базой данных
│   ├── services/    # Бизнес-логика сервисов
│   ├── storage/     # Абстракция для работы с хранилищем данных
│   └── utils/       # Вспомогательные утилиты
└── tests/           # Интеграционные тесты
    └── suite/       # Вспомогательный код для тестов
```
